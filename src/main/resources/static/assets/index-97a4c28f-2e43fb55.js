import{l as w,p as v}from"./transformUtil-999da02b-1268ffeb.js";import{h as M}from"./tooltipUtil-4635a4f7-2c64bc23.js";import{R as z}from"./baiduMapUtil-43da863a-0f4da46f.js";import{b as B,c as k,d as S,a as x}from"./index-1ede4d6c-021f9bd8.js";import{ad as l,aT as r,k as N}from"./index-168435c7.js";import"./biTool-e603ec91-d05b025b.js";import"./index-3458eb1c-88d55814.js";import"./chartActionUtil-201ccd97-c4d73bc9.js";import"./api-639c460b.js";import"./_plugin-vue_export-helper-dad06003-f875bd67.js";const R=[{key:"dimension",min:3},{key:"_dimensionAndMetric",eq:4}];async function _({config:e,data:i,context:o,key:a,contextWrap:D,fullConfig:h}){var b,d;const y=await z(e["baidu-map-ak"]);if(y)return y;const t=h.config.model,c=N(i).data||[],f=O(c),T=q(c),m={...v({config:e}),tooltip:{trigger:"item",valueFormatter(p){var n;const s=(((n=t.metric)==null?void 0:n.length)||0)==1?t.metric[0]:t.dimension[t.dimension.length-1];return M(p,s)}},bmap:{center:[e["center-longitude"]||104.114129,e["center-latitude"]||37.550339],zoom:e.zoom||5,roam:!0,mapStyle:{styleJson:[{featureType:"water",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"land",elementType:"all",stylers:{color:"#f3f3f3"}},{featureType:"railway",elementType:"all",stylers:{visibility:"off"}},{featureType:"highway",elementType:"all",stylers:{color:"#fdfdfd"}},{featureType:"highway",elementType:"labels",stylers:{visibility:"off"}},{featureType:"arterial",elementType:"geometry",stylers:{color:"#fefefe"}},{featureType:"arterial",elementType:"geometry.fill",stylers:{color:"#fefefe"}},{featureType:"poi",elementType:"all",stylers:{visibility:"off"}},{featureType:"green",elementType:"all",stylers:{visibility:"off"}},{featureType:"subway",elementType:"all",stylers:{visibility:"off"}},{featureType:"manmade",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"local",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"arterial",elementType:"labels",stylers:{visibility:"off"}},{featureType:"boundary",elementType:"all",stylers:{color:"#fefefe"}},{featureType:"building",elementType:"all",stylers:{color:"#d1d1d1"}},{featureType:"label",elementType:"labels.text.fill",stylers:{color:"#999999"}}]}},series:[{name:(((b=t.metric)==null?void 0:b.length)||0)>0?t.metric[0].label:t.dimension[t.dimension.length-1].label,type:"scatter",coordinateSystem:"bmap",data:f,symbolSize:g,encode:{value:2},label:{formatter:"{b}",position:"right",show:!1},emphasis:{label:{show:!0}}}]},u=e["highlight-top"]||0;return u>0&&m.series.push({name:((((d=t.metric)==null?void 0:d.length)||0)>0?t.metric[0].label:t.dimension[t.dimension.length-1].label)+" -- top "+u,type:"effectScatter",coordinateSystem:"bmap",data:C(f,u),symbolSize:g,encode:{value:2},showEffectOn:"render",rippleEffect:{brushType:"stroke"},label:{formatter:"{b}",position:"right",show:!0},itemStyle:{shadowBlur:10,shadowColor:"#333"},emphasis:{scale:!0},zlevel:1}),console.log(JSON.stringify(m,null,2)),m;function g(p){const n=e["symbol-size"]||40;let s=e["symbol-size-base"]||5;return s>=n&&(s=n/2),Math.abs(p[2])/T*(n-s)+s}}const I=w(_,R,void 0,{skipDataset:!0});function O(e){const i=[];let o=!0;for(const a of e){if(o){o=!1;continue}i.push({name:a[0],value:[a[1],a[2],a[3]]})}return i}function q(e){let i=0,o=!0;for(const a of e){if(o){o=!1;continue}i=Math.max(i,Math.abs(a[3]))}return i}function C(e,i){return e.sort(function(o,a){return a.value[2]-o.value[2]}).slice(0,i)}const H={key:"_bi_bubbleBaiduMap",name:l.t("bi.widgets.bubbleBaiduMap.name"),description:"",icon:"mdiMapMarkerRadiusOutline",sequence:42,transform:I,editor:{model:B({type:"bubbleBaiduMap"},[{_type:"dimension",description:l.t("bi.widgets.bubbleBaiduMap.dimension_description"),option:{maxRow:4,minRow:3}},{_type:"metric",description:l.t("bi.widgets.bubbleBaiduMap.metric_description"),option:{maxRow:1,minRow:0}},...k]),basic:{init:{"center-longitude":104.114129,"center-latitude":37.550339,zoom:5,"highlight-top":0,"symbol-size":40,"symbol-size-base":0},ui:[...S(),r.createInput("baidu-map-ak",l.t("bi.widgets.bubbleBaiduMap.baidu-map-ak")),r.createInputNumber("center-longitude",l.t("bi.widgets.bubbleBaiduMap.center-longitude")),r.createInputNumber("center-latitude",l.t("bi.widgets.bubbleBaiduMap.center-latitude")),r.createInputNumber("zoom",l.t("bi.widgets.bubbleBaiduMap.zoom")),r.createInputNumber("highlight-top",l.t("bi.widgets.bubbleBaiduMap.highlight-top"),{min:0}),r.createInputNumber("symbol-size",l.t("bi.widgets.bubbleBaiduMap.symbol-size")),r.createInputNumber("symbol-size-base",l.t("bi.widgets.bubbleBaiduMap.symbol-size-base"))]},...x({initStyle:{position:"relative"}})}};export{H as default};
