import{d as U,g as b,a as l,o as q,h as B,w as t,i as O,f as e,e as g,z as P,j as G,b as M,t as I,m as L,F as A,D as j,H as E,E as N,s as K,c as Q,u as z,N as X,k as Z,O as ee}from"./index-fe75cf19.js";import{c as te}from"./index-7c2cadb6.js";import{_ as oe}from"./index.vue_vue_type_style_index_0_lang-b3581869.js";const ne={class:"dialog-footer"},le=U({__name:"MenuEditorDialog",setup(k,{expose:h}){function f(c,i){o.value=c,n=i,u.value=!0}const u=b(!1),o=b({});let n;const v=b(),_=async c=>{c&&await c.validate(i=>{i&&(u.value=!1,n&&n(o.value))})};return h({show:f}),(c,i)=>{const w=l("el-input"),p=l("el-form-item"),a=l("lc-icon-picker"),s=l("el-input-number"),C=l("el-form"),y=l("el-button"),D=l("el-dialog");return q(),B(D,{modelValue:u.value,"onUpdate:modelValue":i[6]||(i[6]=m=>u.value=m),"destroy-on-close":!0,title:"Menu editor","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[O("span",ne,[e(y,{onClick:i[4]||(i[4]=m=>u.value=!1)},{default:t(()=>[g("Cancel")]),_:1}),e(y,{type:"primary",onClick:i[5]||(i[5]=m=>_(v.value))},{default:t(()=>[g(" Save ")]),_:1})])]),default:t(()=>[e(C,{ref_key:"dataEditorFormRef",ref:v,model:o.value,"label-width":"120px"},{default:t(()=>[e(p,{label:"Name",prop:"name",required:""},{default:t(()=>[e(w,{modelValue:o.value.name,"onUpdate:modelValue":i[0]||(i[0]=m=>o.value.name=m)},null,8,["modelValue"])]),_:1}),e(p,{label:"Description",prop:"description"},{default:t(()=>[e(w,{modelValue:o.value.description,"onUpdate:modelValue":i[1]||(i[1]=m=>o.value.description=m)},null,8,["modelValue"])]),_:1}),e(p,{label:"Icon",prop:"icon"},{default:t(()=>[e(a,{modelValue:o.value.icon,"onUpdate:modelValue":i[2]||(i[2]=m=>o.value.icon=m)},null,8,["modelValue"])]),_:1}),e(p,{label:"Sequence",prop:"sequence"},{default:t(()=>[e(s,{modelValue:o.value.sequence,"onUpdate:modelValue":i[3]||(i[3]=m=>o.value.sequence=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ae={class:"lc-common-toolbar",style:{"background-color":"var(--el-color-primary)","margin-top":"10px 0","border-radius":"4px 4px 0px 0px"}},ue=O("div",{class:"left",style:{"font-weight":"bold"}},"Menus",-1),ie=U({__name:"index",emits:["selectionChanged"],setup(k,{emit:h}){const f=P("globalContext"),u=P("appContext"),o=b([]);G(()=>u.key.value,()=>{n()},{immediate:!0});function n(){u.key.value&&f.request({method:"GET",url:"menu/query",params:{app:u.key.value}}).then(function(a){o.value=a.list||[],o.value.push({_id:"",name:"Show all pages"})})}function v(a){h("selectionChanged",a._id)}const _=b();function c(){_.value.show({app:u.key.value,sequence:999},w)}function i(a){const s=j(a.row);_.value.show(s,w)}const w=a=>{f.request({method:"POST",url:"menu/save",data:a}).then(function(){n(),E({message:"Menu saved",type:"success"})})},p=a=>{N.confirm("Will you want to delte this menu?All the pages under this menu will be unlinked!","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{f.request({method:"POST",url:"menu/delete",params:{id:a.row._id}}).then(function(){n(),E({message:"Menu deleted",type:"success"})})})};return(a,s)=>{const C=l("lc-icon"),y=l("el-button"),D=l("el-button-group"),m=l("el-table-column"),R=l("el-table");return q(),M(A,null,[O("div",ae,[ue,e(D,{class:"right"},{default:t(()=>[e(y,{onClick:n},{icon:t(()=>[e(C,{icon:"mdiRefresh"})]),default:t(()=>[g("Refresh")]),_:1}),e(y,{onClick:c},{icon:t(()=>[e(C,{icon:"mdiPlus"})]),default:t(()=>[g("Add menu")]),_:1})]),_:1})]),e(R,{data:o.value,"show-header":!1,"highlight-current-row":!0,onRowClick:v,style:{height:"calc(100% - 42px)",border:"1px solid var(--el-color-primary)"}},{default:t(()=>[e(m,{prop:"name",label:"Name"},{default:t(V=>[e(C,{icon:V.row.icon||"",size:"medium",style:{"margin-right":"16px"}},null,8,["icon"]),g(" "+I(V.row.name),1)]),_:1}),e(m,{label:"Operations",width:"116"},{default:t(V=>[V.row._id?(q(),B(D,{key:0},{default:t(()=>[e(y,{onClick:r=>i(V)},{icon:t(()=>[e(C,{icon:"mdiSquareEditOutline"})]),_:2},1032,["onClick"]),e(y,{onClick:r=>p(V)},{icon:t(()=>[e(C,{icon:"mdiTrashCanOutline"})]),_:2},1032,["onClick"])]),_:2},1024)):L("",!0)]),_:1})]),_:1},8,["data"]),e(le,{ref_key:"menuEditorDialogRef",ref:_},null,512)],64)}}}),se={class:"dialog-footer"},re=U({__name:"PageEditorDialog",setup(k,{expose:h}){const f=P("globalContext");function u(a,s){n.value=a,v=s,o.value=!0}const o=b(!1),n=b({});let v;const _=b(),c=P("appContext"),i=b([]);function w(){c.key.value&&f.request({method:"GET",url:"menu/query",params:{app:c.key.value}}).then(function(a){i.value=a.list||[]})}const p=async a=>{a&&await a.validate(s=>{s&&(o.value=!1,v&&v(n.value))})};return h({show:u}),(a,s)=>{const C=l("el-input"),y=l("el-form-item"),D=l("el-option"),m=l("el-select"),R=l("lc-icon-picker"),V=l("el-input-number"),r=l("el-form"),x=l("el-button"),$=l("el-dialog");return q(),B($,{modelValue:o.value,"onUpdate:modelValue":s[7]||(s[7]=d=>o.value=d),title:"Page editor","destroy-on-close":!0,onOpen:w,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[O("span",se,[e(x,{onClick:s[5]||(s[5]=d=>o.value=!1)},{default:t(()=>[g("Cancel")]),_:1}),e(x,{type:"primary",onClick:s[6]||(s[6]=d=>p(_.value))},{default:t(()=>[g(" Save ")]),_:1})])]),default:t(()=>[e(r,{ref_key:"dataEditorFormRef",ref:_,model:n.value,"label-width":"120px"},{default:t(()=>[e(y,{label:"Name",prop:"name",required:""},{default:t(()=>[e(C,{modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=d=>n.value.name=d)},null,8,["modelValue"])]),_:1}),e(y,{label:"Description",prop:"description"},{default:t(()=>[e(C,{modelValue:n.value.description,"onUpdate:modelValue":s[1]||(s[1]=d=>n.value.description=d)},null,8,["modelValue"])]),_:1}),e(y,{label:"Menu",prop:"menu"},{default:t(()=>[e(m,{modelValue:n.value.menu,"onUpdate:modelValue":s[2]||(s[2]=d=>n.value.menu=d),clearable:""},{default:t(()=>[(q(!0),M(A,null,K(i.value,d=>(q(),B(D,{key:d._id,label:d.name,value:d._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(y,{label:"Icon",prop:"icon"},{default:t(()=>[e(R,{modelValue:n.value.icon,"onUpdate:modelValue":s[3]||(s[3]=d=>n.value.icon=d)},null,8,["modelValue"])]),_:1}),e(y,{label:"Sequence",prop:"sequence"},{default:t(()=>[e(V,{modelValue:n.value.sequence,"onUpdate:modelValue":s[4]||(s[4]=d=>n.value.sequence=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});function de(k,h){let f=k.headers["content-type"]?k.headers["content-type"]:"application/octet-stream",u=h;if(k.headers["content-disposition"]){let o=k.headers["content-disposition"],n=o.indexOf("filename=");n>=0&&(o=o.substr(n+9),u=o,u=decodeURI(u))}ce(k.data,f,u)}function ce(k,h,f){let u=new Blob([k],{type:h});var o=document.createElement("a"),n=window.URL.createObjectURL(u);o.href=n,o.download=f,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)}const pe={class:"lc-common-toolbar",style:{"background-color":"var(--el-color-primary)","margin-top":"10px 0","border-radius":"4px 4px 0px 0px"}},me=O("div",{class:"left",style:{"font-weight":"bold"}},"Pages",-1),fe=U({__name:"index",props:{menuFilter:{type:String,required:!1,default:""}},emits:["pageDesign"],setup(k,{emit:h}){const f=k,u=P("globalContext"),o=P("appContext"),n=b(""),v=b([]);G(()=>o.key.value,()=>{_()},{immediate:!0});function _(){o.key.value&&u.request({method:"GET",url:"page/query",params:{app:o.key.value}}).then(function(r){v.value=r.list||[]})}const c=Q(()=>v.value.filter(r=>!(f.menuFilter&&r.menu!=f.menuFilter||n.value&&!(r.name&&r.name.indexOf(n.value)>=0||r.description&&r.description.indexOf(n.value)>=0)))),i=b();function w(){const r=[{key:"_root",type:"_container",label:"ROOT",data:{},event:[],styles:{diaplay:"block","min-height":"128px",margin:"10px"},config:{props:{_children:[]}}}];let x={app:o.key.value,sequence:0,apis:[],computed:[],data:[],lifecycle:[],methods:[],ui:r};i.value.show(x,a)}function p(r){const x=j(r.row);i.value.show(x,a)}const a=r=>{u.request({method:"POST",url:"page/saveInfo",data:r}).then(function(){_(),E({message:"Page info saved",type:"success"})})},s=r=>{N.confirm("Will you want to delte this page","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{u.request({method:"POST",url:"page/delete",params:{id:r.row._id}}).then(function(){_(),E({message:"Page deleted",type:"success"})})})},C=r=>{N.confirm("Will you want to copy this page","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{u.request({method:"POST",url:"page/copy",params:{id:r.row._id}}).then(function(){_(),E({message:"Page copied",type:"success"})})})};function y(r){h("pageDesign",r.row._id)}const D=b();function m(){const r=D.value.getSelectionRows();if(!r||r.length==0){E.error("Please select rows first");return}const x=r.map($=>$._id);N.confirm("Do you want to export the select pages?","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{u.request({method:"POST",url:"page/doExport",responseType:"blob",timeout:18e4,fullResponse:!0,data:x}).then(function($){console.log($),de($,"pages.zip")})})}const R=b();function V(r){let x=new FormData;x.append("file",r.file),x.append("app",o.key.value),console.log(r),console.log(x),u.request({method:"post",url:"page/doImport",headers:{"Content-Type":"multipart/form-data"},data:x}).then(function(){_(),E.success("Import done")}).finally(function(){R.value.clearFiles()})}return(r,x)=>{const $=l("el-input"),d=l("lc-icon"),S=l("el-button"),H=l("el-upload"),Y=l("el-button-group"),F=l("el-table-column"),J=l("el-table");return q(),M(A,null,[O("div",pe,[me,e($,{modelValue:n.value,"onUpdate:modelValue":x[0]||(x[0]=T=>n.value=T),placeholder:"Input to filter",class:"middle",clearable:""},null,8,["modelValue"]),e(Y,{class:"right"},{default:t(()=>[e(S,{onClick:_},{icon:t(()=>[e(d,{icon:"mdiRefresh"})]),default:t(()=>[g(" Refresh")]),_:1}),e(S,{onClick:w},{icon:t(()=>[e(d,{icon:"mdiPlus"})]),default:t(()=>[g("Add page")]),_:1}),e(S,{onClick:m},{icon:t(()=>[e(d,{icon:"mdiExport"})]),default:t(()=>[g("Batch export")]),_:1}),e(H,{style:{display:"inline-block",margin:"0px"},ref_key:"doImportRef",ref:R,action:"page/doImport","http-request":V,multiple:!1,"show-file-list":!1,limit:1},{default:t(()=>[e(S,null,{icon:t(()=>[e(d,{icon:"mdiImport"})]),default:t(()=>[g("Import")]),_:1})]),_:1},512)]),_:1})]),e(J,{data:c.value,"highlight-current-row":!0,"table-layout":"fixed",style:{height:"calc(100% - 42px)",border:"1px solid var(--el-color-primary)"},ref_key:"pageEditorTableRef",ref:D},{default:t(()=>[e(F,{type:"selection",width:"55"}),e(F,{prop:"name",label:"Name"},{default:t(T=>[e(d,{icon:T.row.icon||"",size:"medium",style:{"margin-right":"16px"}},null,8,["icon"]),g(" "+I(T.row.name),1)]),_:1}),e(F,{prop:"menu_NAME",label:"Menu"}),e(F,{prop:"_updateTime",label:"Last update"},{default:t(T=>[g(I(z(X)(T.row._updateTime)),1)]),_:1}),e(F,{label:"Operations",width:"290"},{default:t(T=>[e(Y,null,{default:t(()=>[e(S,{onClick:W=>y(T)},{default:t(()=>[g("Design")]),_:2},1032,["onClick"]),e(S,{onClick:W=>p(T)},{default:t(()=>[g("Edit")]),_:2},1032,["onClick"]),e(S,{onClick:W=>s(T)},{default:t(()=>[g("Delete")]),_:2},1032,["onClick"]),e(S,{onClick:W=>C(T)},{default:t(()=>[g("Copy")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),e(re,{ref_key:"pageEditorDialogRef",ref:i},null,512)],64)}}}),_e={class:"left lc-main-title"},ge={class:"right"},ve=U({__name:"index",emits:["pageDesign","return"],setup(k,{emit:h}){const f=P("globalContext"),u=P("appContext"),o=b("");Z(()=>{document.body.ondrop=function(c){c.preventDefault(),c.stopPropagation()}});function n(c){o.value=c}function v(c){h("pageDesign",c)}function _(){N.confirm("Will you want to deploy this application?This will deploy all the menus and pages","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{f.request({method:"POST",url:"app/deploy",params:{id:u.key.value}}).then(function(){E({message:"APP deployed",type:"success"})})})}return(c,i)=>{const w=l("lc-icon"),p=l("el-button"),a=l("el-button-group"),s=l("el-header"),C=l("el-aside"),y=l("el-main"),D=l("el-container");return q(),B(D,{style:{height:"100%"}},{default:t(()=>[e(s,{class:"lc-common-toolbar"},{default:t(()=>{var m,R,V;return[O("span",_e,I(((V=(R=(m=z(u))==null?void 0:m.app)==null?void 0:R.value)==null?void 0:V.name)||"Applicaiton name is not set"),1),O("span",ge,[e(a,null,{default:t(()=>[e(p,{type:"primary",onClick:i[0]||(i[0]=r=>h("return"))},{icon:t(()=>[e(w,{icon:"mdi-step-backward-2"})]),default:t(()=>[g(" Return")]),_:1}),e(p,{type:"success",onClick:_},{icon:t(()=>[e(w,{icon:"mdiGestureDoubleTap"})]),default:t(()=>[g(" Deploy")]),_:1})]),_:1})])]}),_:1}),e(D,{style:{"margin-top":"8px"}},{default:t(()=>[e(C,{width:"360px",style:{margin:"4px 10px 0 8px",padding:"0px"}},{default:t(()=>[e(ie,{onSelectionChanged:n})]),_:1}),e(y,{style:{margin:"4px 10px 0 8px",padding:"0px"}},{default:t(()=>[e(fe,{menuFilter:o.value,onPageDesign:v},null,8,["menuFilter"])]),_:1})]),_:1})]),_:1})}}}),xe=U({__name:"index",props:{modelValue:{type:String,required:!1,default:[]}},emits:["return"],setup(k,{emit:h}){const f=k,u=P("globalContext"),o=te(u);ee("appContext",o),G(()=>f.modelValue,()=>{f.modelValue&&(o.key.value=f.modelValue)},{immediate:!0});const n=b("app"),v=b({});function _(p){u.request({method:"GET",url:"page/load",params:{id:p}}).then(function(a){v.value=a,n.value="design"})}function c(p,a){p=="return"?i():p=="save"&&w(a)}function i(){n.value="app"}function w(p){u.request({method:"POST",url:"page/save",data:p}).then(function(){E({message:"Page  saved",type:"success"})})}return(p,a)=>(q(),M(A,null,[n.value=="app"?(q(),B(ve,{key:0,onPageDesign:_,onReturn:a[0]||(a[0]=s=>h("return"))})):L("",!0),n.value=="design"?(q(),B(oe,{key:1,modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=s=>v.value=s),onAction:c},null,8,["modelValue"])):L("",!0)],64))}});export{xe as _};
