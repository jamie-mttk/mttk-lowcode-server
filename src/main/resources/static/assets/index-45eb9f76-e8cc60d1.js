import{l as w,m as u,p as N}from"./transformUtil-999da02b-1268ffeb.js";import{h as f}from"./tooltipUtil-4635a4f7-2c64bc23.js";import{b as P,c as T,d as _,a as A}from"./index-1ede4d6c-021f9bd8.js";import{ad as v,k as C}from"./index-168435c7.js";import"./biTool-e603ec91-d05b025b.js";import"./index-3458eb1c-88d55814.js";import"./chartActionUtil-201ccd97-c4d73bc9.js";import"./_plugin-vue_export-helper-dad06003-f875bd67.js";const q=[{key:"dimension",min:1},{key:"metric",min:1}];function R({config:p,data:e,context:d,key:l,contextWrap:m,fullConfig:o}){var i;const n=o.config.model,t=u(n,"metric",0),{dimenions:s,dataBase:a,dataPositive:h,dataNegative:y,hasPositive:g,hasNegative:b,total:k}=B(e),c={...N({config:p,skipLegend:!0}),xAxis:{type:"category",name:(i=u(n,"dimension",0))==null?void 0:i.label,data:s},yAxis:{type:"value",name:t?.label},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(r){const x=r[1].value=="-"?-1*r[2].value:r[1].value;return r[1].name+"<br/>"+r[1].seriesName+" : "+f(x,t)+"<br/>Total : "+f(k,t)}},series:[{name:"Total",type:"bar",stack:"Total",itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:a}]};return g&&c.series.push({type:"bar",name:t?.label||t?.column,stack:"Total",data:h}),b&&c.series.push({type:"bar",name:(t?.label||t?.column)+" negative",stack:"Total",data:y}),c}function B(p){const e=C(p).data,d=[],l=[],m=[],o=[];let i=0,n=!1,t=!1;if(e&&Array.isArray(e)&&e.length>0)for(let s=1;s<e.length;s++){const a=e[s];d.push(a[0]),a[1]>=0?(m.push(a[1]),o.push("-"),l.push(i),n=!0):(m.push("-"),o.push(-1*a[1]),l.push(i+a[1]),t=!0),i+=a[1]}return{dimenions:d,dataBase:l,dataPositive:m,dataNegative:o,hasPositive:n,hasNegative:t,total:i}}const D=w(R,q,void 0,{skipDataset:!0}),E={key:"_bi_waterfall",name:v.t("bi.widgets.waterfall.name"),description:"",icon:"mdiChartWaterfall",sequence:14,transform:D,editor:{model:P({type:"waterfall"},["dimension",{_type:"metric",description:v.t("bi.widgets.waterfall.metric_description"),option:{maxRow:1,minRow:1}},...T]),basic:{init:{},ui:[..._()]},...A()}};export{E as default};
