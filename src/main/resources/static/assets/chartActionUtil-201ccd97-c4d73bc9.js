import{aE as J,k as c,z as f,ad as v,r as C,d as U,ao as M,a as S,b as E,v as $,g as H,aj as Q,aF as G,aG as Z,p as X,j as Y,f as ee,aq as O,K as j,aH as K,W as b,aI as te,aJ as ne,D as W,al as oe,ay as A,ap as re,B as ie,au as le,c as ae,o as se,aK as ue,am as ce,aL as fe,aM as pe,ar as de,aN as ve,aO as me,aP as he}from"./index-168435c7.js";import{r as ge}from"./biTool-e603ec91-d05b025b.js";const ye=U({__name:"ExtendTableColumn",props:["prop","label","widthPerChar","widthGap"],setup(t){const e=C(null),i=t,o=f(()=>{var r,s,u;const a=c((u=(s=(r=M())==null?void 0:r.parent)==null?void 0:s.props)==null?void 0:u.data)||[];return Array.isArray(a)&&a.length>0?typeof a[0][i.prop]=="number":!1}),n=f(()=>o.value?"right":"left"),l=f(()=>{var r,s,u;const a=c((u=(s=(r=M())==null?void 0:r.parent)==null?void 0:s.props)==null?void 0:u.data)||[];let p=(i.label||"").length;if(Array.isArray(a)&&a.length>0)for(const h of a){const m=h[i.prop];m!=null&&(p=Math.max(p,(m.toString()||m).length))}return(i.widthPerChar||8)*p+(i.widthGap||42)+"px"});return(r,s)=>{const u=S("el-table-column");return E(),$(u,{ref_key:"tableColumnRef",ref:e,prop:i.prop,label:i.label,"min-width":l.value,align:n.value},{default:H(a=>[Q(r.$slots,"default",G(Z(a)),()=>[X(Y(a.row[i.prop]),1)])]),_:3},8,["prop","label","min-width","align"])}}});function be(t,e){return typeof e=="function"&&(e=e(t)),e=we(e),e["~instanceKey"]||(e["~instanceKey"]=F()),e}function F(){let t=Date.now().toString(36),e=Math.random().toString(36);return e=e.substring(2,e.length),e+t}function we(t){return b(t)?t.value:te(t)?K(t):t}function xe(t){return typeof t.then=="function"&&typeof t.catch=="function"}function q(t){return W("contextOfLastFuncComp",void 0)||Ae(t)}function Ae(t){let e=t;for(;;)if(e.parent)e=e.parent;else return e}function Ce(t,e){if(!e)return t;let i=b(t)?t.value:t,o=e.split(".");for(let n=0;n<o.length;n++)if(i=i[o[n]],i==null)return;return i}function Ue(t,e,i,o=!1){if(!e)return t;let n=b(t)?t.value:t,l=e.split(".");for(let r=0;r<l.length;r++){if(r==l.length-1){n[l[r]]=i;break}n[l[r]]?o&&typeof n[l[r]]!="object"&&(n[l[r]]={}):n[l[r]]={},n=n[l[r]]}return t}function Ve(t){const e=f(()=>t&&t.value!=null&&t.value.hasOwnProperty("~modelValue")),i=f({get(){if(!e.value)return;let n=t.value["~modelValuePath"];return n?Ce(c(t.value["~modelValue"]),n):c(t.value["~modelValue"])},set(n){if(!e.value)return;let l=t.value["~modelValuePath"];l?Ue(c(t.value["~modelValue"]),l,n):b(t.value["~modelValue"])?t.value["~modelValue"].value=n:t.value["~modelValue"]=n}}),o=f(()=>t.value["~modelValueName"]||"modelValue");return{hasModelValue:e,modelValue:i,modelValueName:o}}function je(t,e){const i={};return U({setup(o,n){t.context=n,j("contextOfLastFuncComp",t);const l=o.config||{},r=e(l,t);let s,u;if(typeof r=="object"&&(r["~"]||r["~component"])?s=r:(s=r.config,u=r.methods||{}),u)for(const a of Object.keys(u))i[a]=u[a];return()=>A(k,{config:s,contextParent:t,slotPara:o.slotPara})},props:{config:{type:Object,required:!0,default(){return{}}},contextParent:{type:Object,required:!1,default(){}},slotPara:{type:Object,required:!1,default(){}}},methods:i})}function ke(t,e){const i=f(()=>{const r=e.value["~component"]||e.value["~"];return r?xe(r)?ne(()=>r):typeof r=="function"?je(t,r):typeof r=="string"?Pe(r):r:"div"}),o=f(()=>{const r=e.value["~if"];return r==null?!0:!!c(r)}),n=f(()=>e.value["~show"]!=null),l=f(()=>{const r=e.value["~show"];return r==null?!0:!!c(r)});return f(()=>{}),{baseComponent:i,ifFlag:o,hasShowFlag:n,showFlag:l}}function Pe(t){return t=="div"||t=="span"?t:S(t)}function Me(t){const e=i();function i(){const l=W("mttkVueWrapInstances",void 0);if(l!=null)return l;const r={};return j("mttkVueWrapInstances",r),r}function o(l){let r=t.value["~instanceKey"];r&&(l?e[r]=l:delete e[r])}function n(l){if(l||(l=t.value["~instanceKey"]),!(!l||!e))return e[l]}return{setComponentInstance:o,getRef:n}}function Oe(t,e){return f(()=>{if(typeof(e.value["~component"]||e.value["~"])=="function")return{config:e.value};const i={};for(const o of Object.keys(e.value))/^[A-Za-z]/.test(o.charAt(0))&&(i[o]=c(e.value[o]),Se(i),Ee(i));return i})}function Se(t){const e=t.style;if(typeof e!="object")return;const i={};for(const o of Object.keys(e)){const n=e[o];i[o]=c(n)}t.style=i}function Ee(t){const e=t.class;if(!Array.isArray(e))return;const i=[];for(const o of e)i.push(c(o));t.class=i}function Ke(t,e){let i=q(t);return f(()=>{const o={};for(const n of Object.keys(e.value)){if(!n.startsWith("@"))continue;const l=e.value[n],r=D(n,l);if(!r||!r.value==null)continue;const{eventKey:s,modifiers:u}=We(n),a=qe(t,i,r,n,l);a&&(u&&u.length>0?o[s]=oe(a,u):o[s]=a)}return o})}function We(t){let e=t;e.startsWith("@")&&(e=e.slice(1));const i=e.indexOf("."),o=i>=0?e.substring(i+1):void 0;i>=0&&(e=e.substring(0,i)),e="on-"+e,e=e.replace(/[-](\w)/g,function(l,r){return r.toUpperCase()});const n=[];if(o){const l=o.split(".");for(const r of l)r=="passive"||r=="capture"||r=="once"?e=e+r.substring(0,1).toUpperCase()+r.substring(1):n.push(r)}return{eventKey:e,modifiers:n}}function Fe(t,e){if(e)return e.startsWith("@")?e.substring(1):e;let i=t.indexOf(".");return i>=0?t.substring(1,i):t.substring(1)}function D(t,e){if(e==null||typeof e=="string")return{type:"inherit",value:e??t};if(typeof e=="function")return{type:"function",value:e??t};if(typeof e=="object")return e;console.log("unsupported event["+t+"]:"+e)}function N(t,e){const i=t.paraMode||"contextFirst",o=t.value;if(typeof o!="function"){console.log("function value should be type of funciton",t);return}return i=="raw"?o:i=="contextLast"?function(...n){o(...n,e)}:i=="combine"?function(...n){o({context:e,args:n})}:function(...n){o(e,...n)}}function w(t,e,i,...o){if(!e.parent){const n=e.configStd.value["@"+i];if(n){const l=D("@"+i,n);if(l.type=="function"){const r=N(l,t);r&&r(...o)}}}e.context.emit(i,...o)}function qe(t,e,i,o,n){const l=i.type;if(l=="inherit"){const r=Fe(o,i.value),s=i.paraMode||"raw";return function(...u){(o==n||o=="@"+n)&&e.instanceKey==t.instanceKey||(s=="contextFirst"?w(t,e,r,t,...u):s=="contextLast"?w(t,e,r,...u,t):s=="combine"?w(t,e,r,{context:t,args:u}):w(t,e,r,...u))}}else{if(l=="function")return N(i,t);console.log("unsupported event object ["+o+"]:"+n);return}}const De=["innerHTML"],Ne=U({__name:"MttkWrapHtml",props:{html:String},setup(t){const e=t;return(i,o)=>(E(),ae("span",{innerHTML:e.html},null,8,De))}});function Re(t,e){const i=q(t);return f(()=>{const o={};for(const n of Object.keys(e.value))n.startsWith("#")&&(o[n=="#"?"default":n.substring(1)]=function(l){const r=[];if(V(t,i,r,l,e.value[n]),r.length!=0)return r});return o})}function V(t,e,i,o,n){if(b(n)&&(n=n.value),n!=null)if(Array.isArray(n))for(const l of n)V(t,e,i,o,l);else if(typeof n=="function")V(t,e,i,o,n(o,t));else if(typeof n=="string")if(n.startsWith("#")){const l=n=="#"?"default":n.substring(1),r=e.context.slots[l];r&&typeof r=="function"&&i.push(r(o))}else i.push(A(Ne,{html:n}));else if(re(n))i.push(n);else if(typeof n=="object"){let l=n["~key"]||"";l=="_UNIQUE"&&(l=F()),i.push(A(k,{config:n,contextParent:t,slotPara:o,key:l}))}else i.push("Unsuported slot config:"+n)}function Be(t,e){function i(){se(()=>o("onMounted")),ue(()=>o("onUpdated")),ce(()=>o("onUnmounted")),fe(()=>o("onBeforeMount")),pe(()=>o("onBeforeUpdate")),de(()=>o("onBeforeUnmount")),ve(()=>o("onActivated")),me(()=>o("onDeactivated")),he((n,l,r)=>o("onErrorCaptured",n,l,r))}function o(n,...l){const r=e.value["^"+n];if(r)if(Array.isArray(r))for(const s of r)if(typeof s=="function")s(t,...l);else throw Error("Unsuported handler for lifecycle:"+n+" in array");else if(typeof r=="function")r(t,...l);else throw Error("Unsuported handler for lifecycle:"+n)}return i}function Le(t,e){const i=I(),o=f(()=>be(i,t.config)),{hasModelValue:n,modelValue:l,modelValueName:r}=Ve(o),{setComponentInstance:s,getRef:u}=Me(o),a=T(i),{baseComponent:p,ifFlag:h,hasShowFlag:m,showFlag:g}=ke(a,o),y=Oe(a,o),R=Ke(a,o),B=f(()=>{const d={ref:s,key:o.value["~instanceKey"],...y.value,...R.value};return n.value&&(d[r.value]=l.value,d["onUpdate:"+r.value]=z=>{l.value=z}),d}),L=Re(a,o);function _(){if(!h.value)return;const d=A(c(p),c(B),c(L));return m.value?ie(d,[[le,c(g)]]):d}function I(){return{props:K(c(t)),context:e,parent:t.contextParent,slotPara:t.slotPara}}function T(d){return d.modelValue=l,d.getRef=u,d.instanceKey=o.value["~instanceKey"],d.configStd=o,d}return Be(a,o)(),{wrapRender:_,info:{getRef:u,contextWrap:a}}}const k=U({inheritAttrs:!0,emits:["init"],props:{config:[Object,Function],contextParent:{type:Object,required:!1,default(){}},slotPara:{type:Object,required:!1,default(){}}},setup(t,e){const{wrapRender:i,info:o}=Le(t,e);return e.expose(o),e.emit("init",o),j("contextWrap",o.contextWrap),()=>i()}});function P(t,e,i={}){const o=document.createElement("div"),n=u(),l=function(){O(null,o),n.removeChild(o)},r=ee(k,{config:s()});return r.appContext=e,O(r,o),n.appendChild(o),{remove:l,mountNode:o,vNode:r};function s(){const a=i.removeEvent;if(!a)return t;const p={...t};return p["@"+a]=l,console.log(p),p}function u(){const a=i.appendTo;if(a){if(typeof a=="string")return document.querySelector(a);if(a instanceof Element)return a}return document.body}}const{copy:_e,isSupported:Ie}=J();function $e(t,e){const i=c(e).sqls||[],o=f(()=>{const s=c(e).timecost;return s>=1e3?s/1e3+" "+v.t("bi.widgets.utils.chartActionUtil.second"):s+" "+v.t("bi.widgets.utils.chartActionUtil.millsecond")});let n;if(!i||i.length==0)n={"~":"el-empty",description:v.t("bi.widgets.utils.chartActionUtil.noSQL")};else{n={"~":"el-form","label-position":"top","#":[]},n["#"].push({"~":"el-form-item",label:v.t("bi.widgets.utils.chartActionUtil.timecost"),"#":{"~":"el-input","~modelValue":o,readonly:!0}});for(const s of i)n["#"].push(x(s.type,s.sql,6))}const l=C(!1),r={"~":"el-drawer","~modelValue":l,title:v.t("bi.widgets.utils.chartActionUtil.showSQL"),direction:"btt",size:"75%","#":n};P(r,t.appContext.globalContext.vueApp._context,{removeEvent:"close"}),l.value=!0}function He(t,e,i){const o=c(e).data||[],n=!o||o.length==0?{"~":"el-empty",description:v.t("bi.widgets.utils.chartActionUtil.noData")}:Te(o,i),l=C(!1),r={"~":"el-drawer","~modelValue":l,title:v.t("bi.widgets.utils.chartActionUtil.showData"),direction:"btt",size:"80%","#":n};P(r,t.appContext.globalContext.vueApp._context,{removeEvent:"close"}),l.value=!0}function Qe(t,e,i){const o={"~":"el-form","label-position":"top","#":[x(v.t("bi.widgets.utils.chartActionUtil.errorMessage"),e.message,2),x("SQL",e.sql,4),x(v.t("bi.widgets.utils.chartActionUtil.errorDetail"),e.detail,6)]},n=C(!1),l={"~":"el-drawer","~modelValue":n,title:v.t("bi.widgets.utils.chartActionUtil.errorLoadData",[i?.key||""]),direction:"btt",size:"80%","#":o};P(l,t.vueApp._context,{removeEvent:"close"}),n.value=!0}function Te(t,e){var i,o;const n=[],l=((o=(i=e?.config)==null?void 0:i.model)==null?void 0:o.dumpMode)=="JSON"?void 0:[],r={"~component":"el-table",style:{height:"100%"},border:!0,stripe:!0,"#":n};return n.push({"~":"el-table-column",type:"index",label:"#",width:"50"}),s(),r.data=a(),r;function s(){u("dimension"),u("metric")}function u(p){for(const h of Object.keys(e.config.model||{})){if(!h.startsWith(p))continue;const m=e.config.model[h];for(const g of m)n.push({"~":ye,prop:g.id,label:g.label||g.key,sortable:!0}),l?.push(g)}}function a(){if(l==null)return t;const p=[];let h=!0;for(const m of t){if(h){h=!1;continue}const g={};p.push(g);for(let y=0;y<Math.min(m.length,l.length);y++)g[l[y].id]=m[y]}return p}}function x(t,e,i=6){return{"~":"el-form-item","#label":{"~":"div","#":[t,{"~":"lc-icon","~show":Ie,icon:"mdiContentCopy",tooltip:v.t("bi.widgets.utils.chartActionUtil.copyTip"),style:{cursor:"pointer","margin-left":"10px"},"@click":function(){_e(e),ge({message:v.t("bi.widgets.utils.chartActionUtil.copyDone"),type:"success"})}}]},"#":{"~":"el-input","~modelValue":e,type:"textarea",rows:i,readonly:!0}}}export{Qe as $,$e as J,He as Z,ye as g};
