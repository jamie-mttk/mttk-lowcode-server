import{d as B,g as y,a as l,o as q,h as U,w as t,i as O,f as e,e as g,z as P,j as L,b as M,t as I,m as G,F as A,C as j,G as E,E as N,s as K,c as Q,u as z,M as X,k as Z,N as ee}from"./index-7d1a1b21.js";import{c as te}from"./index-e99525b4.js";import{_ as oe}from"./index.vue_vue_type_style_index_0_lang-ad02fd04.js";const ne={class:"dialog-footer"},le=B({__name:"MenuEditorDialog",setup(k,{expose:h}){function f(c,s){o.value=c,n=s,i.value=!0}const i=y(!1),o=y({});let n;const b=y(),_=async c=>{c&&await c.validate(s=>{s&&(i.value=!1,n&&n(o.value))})};return h({show:f}),(c,s)=>{const C=l("el-input"),p=l("el-form-item"),a=l("lc-icon-picker"),u=l("el-input-number"),w=l("el-form"),v=l("el-button"),D=l("el-dialog");return q(),U(D,{modelValue:i.value,"onUpdate:modelValue":s[6]||(s[6]=m=>i.value=m),"destroy-on-close":!0,title:"Menu editor","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[O("span",ne,[e(v,{onClick:s[4]||(s[4]=m=>i.value=!1)},{default:t(()=>[g("Cancel")]),_:1}),e(v,{type:"primary",onClick:s[5]||(s[5]=m=>_(b.value))},{default:t(()=>[g(" Save ")]),_:1})])]),default:t(()=>[e(w,{ref_key:"dataEditorFormRef",ref:b,model:o.value,"label-width":"120px"},{default:t(()=>[e(p,{label:"Name",prop:"name",required:""},{default:t(()=>[e(C,{modelValue:o.value.name,"onUpdate:modelValue":s[0]||(s[0]=m=>o.value.name=m)},null,8,["modelValue"])]),_:1}),e(p,{label:"Description",prop:"description"},{default:t(()=>[e(C,{modelValue:o.value.description,"onUpdate:modelValue":s[1]||(s[1]=m=>o.value.description=m)},null,8,["modelValue"])]),_:1}),e(p,{label:"Icon",prop:"icon"},{default:t(()=>[e(a,{modelValue:o.value.icon,"onUpdate:modelValue":s[2]||(s[2]=m=>o.value.icon=m)},null,8,["modelValue"])]),_:1}),e(p,{label:"Sequence",prop:"sequence"},{default:t(()=>[e(u,{modelValue:o.value.sequence,"onUpdate:modelValue":s[3]||(s[3]=m=>o.value.sequence=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),ae={class:"lc-common-toolbar",style:{"background-color":"var(--el-color-primary)","margin-top":"10px 0","border-radius":"4px 4px 0px 0px"}},ue=O("div",{class:"left",style:{"font-weight":"bold"}},"Menus",-1),ie=B({__name:"index",emits:["selectionChanged"],setup(k,{emit:h}){const f=P("globalContext"),i=P("appContext"),o=y([]);L(()=>i.key.value,()=>{n()},{immediate:!0});function n(){i.key.value&&f.request({method:"GET",url:"menu/query",params:{app:i.key.value}}).then(function(a){o.value=a.list||[],o.value.push({_id:"",name:"Show all pages"})})}function b(a){h("selectionChanged",a._id)}const _=y();function c(){_.value.show({app:i.key.value,sequence:0},C)}function s(a){const u=j(a.row);_.value.show(u,C)}const C=a=>{f.request({method:"POST",url:"menu/save",data:a}).then(function(){n(),E({message:"Menu saved",type:"success"})})},p=a=>{N.confirm("Will you want to delte this menu?All the pages under this menu will be unlinked!","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{f.request({method:"POST",url:"menu/delete",params:{id:a.row._id}}).then(function(){n(),E({message:"Menu deleted",type:"success"})})})};return(a,u)=>{const w=l("lc-icon"),v=l("el-button"),D=l("el-button-group"),m=l("el-table-column"),R=l("el-table");return q(),M(A,null,[O("div",ae,[ue,e(D,{class:"right"},{default:t(()=>[e(v,{onClick:n},{icon:t(()=>[e(w,{icon:"mdiRefresh"})]),default:t(()=>[g("Refresh")]),_:1}),e(v,{onClick:c},{icon:t(()=>[e(w,{icon:"mdiPlus"})]),default:t(()=>[g("Add menu")]),_:1})]),_:1})]),e(R,{data:o.value,"show-header":!1,"highlight-current-row":!0,onRowClick:b,style:{height:"calc(100% - 42px)",border:"1px solid var(--el-color-primary)"}},{default:t(()=>[e(m,{prop:"name",label:"Name"},{default:t(V=>[e(w,{icon:V.row.icon||"",size:"medium",style:{"margin-right":"16px"}},null,8,["icon"]),g(" "+I(V.row.name),1)]),_:1}),e(m,{label:"Operations",width:"116"},{default:t(V=>[V.row._id?(q(),U(D,{key:0},{default:t(()=>[e(v,{onClick:r=>s(V)},{icon:t(()=>[e(w,{icon:"mdiSquareEditOutline"})]),_:2},1032,["onClick"]),e(v,{onClick:r=>p(V)},{icon:t(()=>[e(w,{icon:"mdiTrashCanOutline"})]),_:2},1032,["onClick"])]),_:2},1024)):G("",!0)]),_:1})]),_:1},8,["data"]),e(le,{ref_key:"menuEditorDialogRef",ref:_},null,512)],64)}}}),se={class:"dialog-footer"},re=B({__name:"PageEditorDialog",setup(k,{expose:h}){const f=P("globalContext");function i(a,u){n.value=a,b=u,o.value=!0}const o=y(!1),n=y({});let b;const _=y(),c=P("appContext"),s=y([]);function C(){c.key.value&&f.request({method:"GET",url:"menu/query",params:{app:c.key.value}}).then(function(a){s.value=a.list||[]})}const p=async a=>{a&&await a.validate(u=>{u&&(o.value=!1,b&&b(n.value))})};return h({show:i}),(a,u)=>{const w=l("el-input"),v=l("el-form-item"),D=l("el-option"),m=l("el-select"),R=l("lc-icon-picker"),V=l("el-input-number"),r=l("el-form"),x=l("el-button"),$=l("el-dialog");return q(),U($,{modelValue:o.value,"onUpdate:modelValue":u[8]||(u[8]=d=>o.value=d),title:"Page editor","destroy-on-close":!0,onOpen:C,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[O("span",se,[e(x,{onClick:u[6]||(u[6]=d=>o.value=!1)},{default:t(()=>[g("Cancel")]),_:1}),e(x,{type:"primary",onClick:u[7]||(u[7]=d=>p(_.value))},{default:t(()=>[g(" Save ")]),_:1})])]),default:t(()=>[e(r,{ref_key:"dataEditorFormRef",ref:_,model:n.value,"label-width":"120px"},{default:t(()=>[e(v,{label:"ID",prop:"_id"},{default:t(()=>[e(w,{modelValue:n.value._id,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value._id=d),disabled:!0},null,8,["modelValue"])]),_:1}),e(v,{label:"Name",prop:"name",required:""},{default:t(()=>[e(w,{modelValue:n.value.name,"onUpdate:modelValue":u[1]||(u[1]=d=>n.value.name=d)},null,8,["modelValue"])]),_:1}),e(v,{label:"Description",prop:"description"},{default:t(()=>[e(w,{modelValue:n.value.description,"onUpdate:modelValue":u[2]||(u[2]=d=>n.value.description=d)},null,8,["modelValue"])]),_:1}),e(v,{label:"Menu",prop:"menu"},{default:t(()=>[e(m,{modelValue:n.value.menu,"onUpdate:modelValue":u[3]||(u[3]=d=>n.value.menu=d),clearable:""},{default:t(()=>[(q(!0),M(A,null,K(s.value,d=>(q(),U(D,{key:d._id,label:d.name,value:d._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"Icon",prop:"icon"},{default:t(()=>[e(R,{modelValue:n.value.icon,"onUpdate:modelValue":u[4]||(u[4]=d=>n.value.icon=d)},null,8,["modelValue"])]),_:1}),e(v,{label:"Sequence",prop:"sequence"},{default:t(()=>[e(V,{modelValue:n.value.sequence,"onUpdate:modelValue":u[5]||(u[5]=d=>n.value.sequence=d)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});function de(k,h){let f=k.headers["content-type"]?k.headers["content-type"]:"application/octet-stream",i=h;if(k.headers["content-disposition"]){let o=k.headers["content-disposition"],n=o.indexOf("filename=");n>=0&&(o=o.substr(n+9),i=o,i=decodeURI(i))}ce(k.data,f,i)}function ce(k,h,f){let i=new Blob([k],{type:h});var o=document.createElement("a"),n=window.URL.createObjectURL(i);o.href=n,o.download=f,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)}const pe={class:"lc-common-toolbar",style:{"background-color":"var(--el-color-primary)","margin-top":"10px 0","border-radius":"4px 4px 0px 0px"}},me=O("div",{class:"left",style:{"font-weight":"bold"}},"Pages",-1),fe=B({__name:"index",props:{menuFilter:{type:String,required:!1,default:""}},emits:["pageDesign"],setup(k,{emit:h}){const f=k,i=P("globalContext"),o=P("appContext"),n=y(""),b=y([]);L(()=>o.key.value,()=>{_()},{immediate:!0});function _(){o.key.value&&i.request({method:"GET",url:"page/query",params:{app:o.key.value}}).then(function(r){b.value=r.list||[]})}const c=Q(()=>b.value.filter(r=>!(f.menuFilter&&r.menu!=f.menuFilter||n.value&&!(r.name&&r.name.indexOf(n.value)>=0||r.description&&r.description.indexOf(n.value)>=0)))),s=y();function C(){const r=[{key:"_root",type:"_container",label:"ROOT",data:{},event:[],styles:{diaplay:"block","min-height":"128px",margin:"10px"},config:{props:{_children:[]}}}];let x={app:o.key.value,sequence:0,apis:[],computed:[],data:[],lifecycle:[],methods:[],ui:r};s.value.show(x,a)}function p(r){const x=j(r.row);s.value.show(x,a)}const a=r=>{i.request({method:"POST",url:"page/saveInfo",data:r}).then(function(){_(),E({message:"Page info saved",type:"success"})})},u=r=>{N.confirm("Will you want to delte this page","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{i.request({method:"POST",url:"page/delete",params:{id:r.row._id}}).then(function(){_(),E({message:"Page deleted",type:"success"})})})},w=r=>{N.confirm("Will you want to copy this page","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{i.request({method:"POST",url:"page/copy",params:{id:r.row._id}}).then(function(){_(),E({message:"Page copied",type:"success"})})})};function v(r){h("pageDesign",r.row._id)}const D=y();function m(){const r=D.value.getSelectionRows();if(!r||r.length==0){E.error("Please select rows first");return}const x=r.map($=>$._id);N.confirm("Do you want to export the select pages?","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{i.request({method:"POST",url:"page/doExport",responseType:"blob",timeout:18e4,fullResponse:!0,data:x}).then(function($){console.log($),de($,"pages.zip")})})}const R=y();function V(r){let x=new FormData;x.append("file",r.file),x.append("app",o.key.value),console.log(r),console.log(x),i.request({method:"post",url:"page/doImport",headers:{"Content-Type":"multipart/form-data"},data:x}).then(function(){_(),E.success("Import done")}).finally(function(){R.value.clearFiles()})}return(r,x)=>{const $=l("el-input"),d=l("lc-icon"),S=l("el-button"),H=l("el-upload"),Y=l("el-button-group"),F=l("el-table-column"),J=l("el-table");return q(),M(A,null,[O("div",pe,[me,e($,{modelValue:n.value,"onUpdate:modelValue":x[0]||(x[0]=T=>n.value=T),placeholder:"Input to filter",class:"middle",clearable:""},null,8,["modelValue"]),e(Y,{class:"right"},{default:t(()=>[e(S,{onClick:_},{icon:t(()=>[e(d,{icon:"mdiRefresh"})]),default:t(()=>[g(" Refresh")]),_:1}),e(S,{onClick:C},{icon:t(()=>[e(d,{icon:"mdiPlus"})]),default:t(()=>[g("Add page")]),_:1}),e(S,{onClick:m},{icon:t(()=>[e(d,{icon:"mdiExport"})]),default:t(()=>[g("Batch export")]),_:1}),e(H,{style:{display:"inline-block",margin:"0px"},ref_key:"doImportRef",ref:R,action:"page/doImport","http-request":V,multiple:!1,"show-file-list":!1,limit:1},{default:t(()=>[e(S,null,{icon:t(()=>[e(d,{icon:"mdiImport"})]),default:t(()=>[g("Import")]),_:1})]),_:1},512)]),_:1})]),e(J,{data:c.value,"highlight-current-row":!0,"table-layout":"fixed",style:{height:"calc(100% - 42px)",border:"1px solid var(--el-color-primary)"},ref_key:"pageEditorTableRef",ref:D},{default:t(()=>[e(F,{type:"selection",width:"55"}),e(F,{prop:"name",label:"Name"},{default:t(T=>[e(d,{icon:T.row.icon||"",size:"medium",style:{"margin-right":"16px"}},null,8,["icon"]),g(" "+I(T.row.name),1)]),_:1}),e(F,{prop:"menu_NAME",label:"Menu"}),e(F,{prop:"_updateTime",label:"Last update"},{default:t(T=>[g(I(z(X)(T.row._updateTime)),1)]),_:1}),e(F,{label:"Operations",width:"290"},{default:t(T=>[e(Y,null,{default:t(()=>[e(S,{onClick:W=>v(T)},{default:t(()=>[g("Design")]),_:2},1032,["onClick"]),e(S,{onClick:W=>p(T)},{default:t(()=>[g("Edit")]),_:2},1032,["onClick"]),e(S,{onClick:W=>u(T)},{default:t(()=>[g("Delete")]),_:2},1032,["onClick"]),e(S,{onClick:W=>w(T)},{default:t(()=>[g("Copy")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),e(re,{ref_key:"pageEditorDialogRef",ref:s},null,512)],64)}}}),_e={class:"left lc-main-title"},ge={class:"right"},ve=B({__name:"index",emits:["pageDesign","return"],setup(k,{emit:h}){const f=P("globalContext"),i=P("appContext"),o=y("");Z(()=>{document.body.ondrop=function(c){c.preventDefault(),c.stopPropagation()}});function n(c){o.value=c}function b(c){h("pageDesign",c)}function _(){N.confirm("Will you want to deploy this application?This will deploy all the menus and pages","Warning",{confirmButtonText:"Yes",cancelButtonText:"No",type:"warning"}).then(()=>{f.request({method:"POST",url:"app/deploy",params:{id:i.key.value}}).then(function(){E({message:"APP deployed",type:"success"})})})}return(c,s)=>{const C=l("lc-icon"),p=l("el-button"),a=l("el-button-group"),u=l("el-header"),w=l("el-aside"),v=l("el-main"),D=l("el-container");return q(),U(D,{style:{height:"100%"}},{default:t(()=>[e(u,{class:"lc-common-toolbar"},{default:t(()=>{var m,R,V;return[O("span",_e,I(((V=(R=(m=z(i))==null?void 0:m.app)==null?void 0:R.value)==null?void 0:V.name)||"Applicaiton name is not set"),1),O("span",ge,[e(a,null,{default:t(()=>[e(p,{type:"primary",onClick:s[0]||(s[0]=r=>h("return"))},{icon:t(()=>[e(C,{icon:"mdi-step-backward-2"})]),default:t(()=>[g(" Return")]),_:1}),e(p,{type:"success",onClick:_},{icon:t(()=>[e(C,{icon:"mdiGestureDoubleTap"})]),default:t(()=>[g(" Deploy")]),_:1})]),_:1})])]}),_:1}),e(D,{style:{"margin-top":"8px"}},{default:t(()=>[e(w,{width:"360px",style:{margin:"4px 10px 0 8px",padding:"0px"}},{default:t(()=>[e(ie,{onSelectionChanged:n})]),_:1}),e(v,{style:{margin:"4px 10px 0 8px",padding:"0px"}},{default:t(()=>[e(fe,{menuFilter:o.value,onPageDesign:b},null,8,["menuFilter"])]),_:1})]),_:1})]),_:1})}}}),xe=B({__name:"index",props:{modelValue:{type:String,required:!1,default:[]}},emits:["return"],setup(k,{emit:h}){const f=k,i=P("globalContext"),o=te(i);ee("appContext",o),L(()=>f.modelValue,()=>{f.modelValue&&(o.key.value=f.modelValue)},{immediate:!0});const n=y("app"),b=y({});function _(p){i.request({method:"GET",url:"page/load",params:{id:p}}).then(function(a){b.value=a,n.value="design"})}function c(p,a){p=="return"?s():p=="save"&&C(a)}function s(){n.value="app"}function C(p){i.request({method:"POST",url:"page/save",data:p}).then(function(){E({message:"Page  saved",type:"success"})})}return(p,a)=>(q(),M(A,null,[n.value=="app"?(q(),U(ve,{key:0,onPageDesign:_,onReturn:a[0]||(a[0]=u=>h("return"))})):G("",!0),n.value=="design"?(q(),U(oe,{key:1,modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=u=>b.value=u),onAction:c},null,8,["modelValue"])):G("",!0)],64))}});export{xe as _};
